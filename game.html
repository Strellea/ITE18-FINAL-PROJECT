<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet" href="game.css">
<title>VOYAGE</title>
</head>
<body>
<div id="score">Score: 0</div>

<button id="pauseBtn">Pause</button>
<div id="pauseMenu">
  <h2>PAUSED</h2>
  <button id="resumeBtn">Resume</button>
  <button id="quitBtn" onclick="window.location.href='home.html'">Quit to Home</button>
</div>

<div id="gameover">
  Game Over!
  <div id="gameover-buttons">
    <button id="saveScoreBtn">Save Score</button>
    <button id="backHomeBtn" onclick="window.location.href='home.html'">Back to Home</button>
    <button id="retry" onclick="window.location.href='game.html'">Retry</button>
  </div>  
</div>

<script type="module" src="src/main.js"></script>

<script>

  const API_URL = 'https://ite18-final-project-production-bb3c.up.railway.app';

  document.getElementById('saveScoreBtn').onclick = async () => {
  const token = localStorage.getItem('token');
  if (!token) return alert('You must be logged in to save your score.');
  const finalScore = parseInt(document.getElementById('score').textContent.replace('Score: ', ''), 10);
  try {
    const response = await fetch(`${API_URL}/score`, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'Authorization': `Bearer ${token}`
      },
      body: JSON.stringify({ score: finalScore })
    });

    const data = await response.json();
    if (data.error) throw new Error(data.error);

    alert('Score saved successfully!');
  } catch (err) {
    console.error(err);
    alert('Failed to save score.');
  }
};

</script>
</body>
</html>
